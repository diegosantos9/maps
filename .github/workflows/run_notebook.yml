# Nome do Workflow - Aparecer√° na aba "Actions" do GitHub
name: Executar Script de Leil√µes Diariamente

# Gatilhos (Triggers) - Quando a automa√ß√£o deve rodar
on:
  # Permite que voc√™ inicie a automa√ß√£o manualmente pela aba Actions
  workflow_dispatch:

  # Agenda a execu√ß√£o autom√°tica
  schedule:
   

# Tarefas (Jobs) - O que a automa√ß√£o vai fazer
jobs:
  executar-notebook:
    # Usa a vers√£o mais recente do Ubuntu como sistema operacional
    runs-on: ubuntu-latest

    steps:
      # 1. Clona seu reposit√≥rio para a m√°quina virtual da Action
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      # 2. Configura o ambiente Python
      - name: Configurar Python 3.9
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Instala todas as bibliotecas que seu script usa
      - name: Instalar depend√™ncias
        run: |
          pip install jupyter pandas papermill
          pip install cloudscraper beautifulsoup4 openpyxl geopy folium tqdm

      # 4. Executa o notebook usando Papermill
      #    AQUI ESTAVA O ERRO: Corrigido o nome do arquivo de h√≠fens para underscores
      - name: Executar o Notebook
        run: papermill 'OK_MAPA_Gyn_e_Ap_Gyn.ipynb' saida.ipynb

      # 5. Salva os arquivos gerados (mapa e excel) de volta no reposit√≥rio
      #    Etapa melhorada para ser mais robusta
      - name: Fazer commit dos resultados
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # Adiciona os arquivos de resultado apenas se eles existirem
          git add saida.ipynb
          if [ -f mapa_leiloes_goias.html ]; then git add mapa_leiloes_goias.html; fi
          if [ -f imoveis_consolidados.xlsx ]; then git add imoveis_consolidados.xlsx; fi
          
          # Faz o commit apenas se houver alguma altera√ß√£o nos arquivos
          # e depois faz o push para o reposit√≥rio
          git diff --quiet && git diff --staged --quiet || (git commit -m "üó∫Ô∏è Atualiza mapa e dados de leil√µes" && git push)
